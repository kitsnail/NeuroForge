# ğŸ§  **NeuroForge v1.3 æ’ä»¶å¼€å‘æŒ‡å—ï¼ˆPlugin Development Guideï¼‰**

> **Version:** 1.3
> **Status:** Stable
> **Scope:** å…¨é¢é€‚é…ã€ŠNeuroForge v1.3 ç»Ÿä¸€æ ‡å‡†è§„èŒƒæŒ‡å—ã€‹
> **Purpose:** è§„èŒƒ NeuroForge æ’ä»¶ç”Ÿæ€ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€å¯æ‰©å±•æ€§ä¸è‡ªåŠ¨ç¼–æ’å…¼å®¹æ€§ã€‚

---

## ğŸŒ ä¸€ã€æ’ä»¶ç³»ç»Ÿå®šä½

NeuroForge çš„æ’ä»¶ç³»ç»Ÿæ˜¯ **AI è§†é¢‘ç¼–æ’æ ¸å¿ƒçš„å¯æ’æ‹”æ‰§è¡Œå±‚ï¼ˆExecution Layerï¼‰**ã€‚
æ¯ä¸ªæ’ä»¶ä»£è¡¨æ—¶é—´çº¿ä¸­çš„ä¸€ä¸ªå¤„ç†èŠ‚ç‚¹ï¼ˆå¦‚è¯­éŸ³åˆæˆã€å›¾åƒç”Ÿæˆã€æ··éŸ³ã€åˆæˆç­‰ï¼‰ã€‚

æ’ä»¶æ˜¯æ— çŠ¶æ€çš„ã€ä¸Šä¸‹æ–‡é©±åŠ¨çš„ï¼ˆContext-drivenï¼‰ï¼Œ
ç”±è°ƒåº¦å™¨ï¼ˆ`Scheduler`ï¼‰ç»Ÿä¸€åŠ è½½ã€æ‰§è¡Œå¹¶è‡ªåŠ¨è¿æ¥æ•°æ®æµã€‚

---

## ğŸ§© äºŒã€æ’ä»¶ç»“æ„è§„èŒƒ

æ¯ä¸ªæ’ä»¶ä½äºï¼š

```
plugins/<plugin_name>/plugin.py
```

ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š

```
plugins/
 â”œâ”€â”€ tts/
 â”‚   â””â”€â”€ plugin.py
 â”œâ”€â”€ mix/
 â”‚   â””â”€â”€ plugin.py
 â”œâ”€â”€ canvas/
 â”‚   â””â”€â”€ plugin.py
 â””â”€â”€ compose/
     â””â”€â”€ plugin.py
```

---

## ğŸ“„ ä¸‰ã€æ’ä»¶æ–‡ä»¶æ¨¡æ¿ï¼ˆæ ‡å‡†åŒ–å¤´éƒ¨ï¼‰

```python
# ===========================================================
# NeuroForge v1.3 Plugin: <plugin_name>
# -----------------------------------------------------------
# åŠŸèƒ½ï¼š
#   <ç®€è¦æè¿°æ’ä»¶çš„ä½œç”¨>
# è¾“å…¥ï¼š
#   ctx : dict ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆç”± SceneRunner æ³¨å…¥ï¼‰
# è¾“å‡ºï¼š
#   {
#     "<plugin_name>": {
#         "status": "ok" / "error" / "skip",
#         "file" / "audio_out" / "video_out" ç­‰æ ‡å‡†å­—æ®µ,
#         "meta": {...} å¯é€‰æ‰©å±•å…ƒæ•°æ®
#     }
#   }
# ===========================================================

import os
from core.logger import log
from core.io import IOManager

def run(ctx):
    plugin = "<plugin_name>"
    scene_dir = ctx["scene_dir"]
    out_dir = IOManager.get_plugin_dir(scene_dir, plugin)
    os.makedirs(out_dir, exist_ok=True)

    log(f"[{plugin}] started...")
    
    # ... æ’ä»¶é€»è¾‘ ...
    
    return {
        plugin: {
            "status": "ok",
            "file": "<output_path>",
            "meta": {"extra_info": "optional"}
        }
    }
```

---

## âš™ï¸ å››ã€ä¸Šä¸‹æ–‡ç»“æ„ï¼ˆ`ctx`ï¼‰

æ’ä»¶é€šè¿‡å‚æ•° `ctx` æ¥æ”¶å®Œæ•´çš„åœºæ™¯ä¸Šä¸‹æ–‡ï¼ˆScene Contextï¼‰ï¼Œ
ç³»ç»Ÿè‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå         | ç±»å‹        | è¯´æ˜                                                |
| ----------- | --------- | ------------------------------------------------- |
| `meta`      | dict      | å…¨å±€é¡¹ç›®ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€ä½œè€…ã€é»˜è®¤BGMç­‰ï¼‰                              |
| `scene`     | dict      | å½“å‰åœºæ™¯å®šä¹‰ï¼ˆå¦‚ `title`, `narration`, `pipeline`, `bgm`ï¼‰ |
| `scene_id`  | int / str | å½“å‰åœºæ™¯ID                                            |
| `scene_dir` | str       | å½“å‰åœºæ™¯è¾“å‡ºç›®å½•                                          |
| `<plugin>`  | dict      | æ¥è‡ªä¸Šæ¸¸æ’ä»¶çš„è¾“å‡ºç»“æœï¼ˆå¦‚ `ctx["tts"]`, `ctx["canvas"]`ï¼‰      |

ç¤ºä¾‹ï¼š

```python
{
  "meta": {"version": "1.3", "project": "Demo"},
  "scene": {"title": "Intro", "narration": "Hello world", "pipeline": ["tts", "mix"]},
  "scene_id": 1,
  "scene_dir": "output/scene_1/",
  "tts": {"audio_out": "output/scene_1/tts/tts.wav"}
}
```

---

## ğŸ“¦ äº”ã€è¾“å‡ºç»“æ„è§„èŒƒï¼ˆå¿…é¡»éµå®ˆï¼‰

æ¯ä¸ªæ’ä»¶éƒ½å¿…é¡»è¿”å›ä¸€ä¸ªé¡¶å±‚å­—å…¸ï¼Œ
é”®ä¸ºæ’ä»¶åï¼ˆä¸ç›®å½•åä¸€è‡´ï¼‰ï¼Œå€¼ä¸ºæ’ä»¶è¾“å‡ºç»“æœå¯¹è±¡ã€‚

### âœ… åŸºæœ¬ç»“æ„

```python
{
  "tts": {
    "status": "ok",
    "audio_out": "output/scene_1/tts/tts.wav",
    "subtitle_out": "output/scene_1/tts/subtitle.srt",
    "duration": 4.23
  }
}
```

### ğŸš¦ çŠ¶æ€å­—æ®µè§„èŒƒ

| çŠ¶æ€å€¼       | å«ä¹‰         | è°ƒåº¦è¡Œä¸º          |
| --------- | ---------- | ------------- |
| `"ok"`    | æ­£å¸¸å®Œæˆ       | ç»“æœå°†ä¼ é€’åˆ°ä¸‹æ¸¸æ’ä»¶    |
| `"skip"`  | è·³è¿‡æ‰§è¡Œï¼ˆè¾“å…¥ä¸è¶³ï¼‰ | ä¸å½±å“åç»­æ‰§è¡Œï¼Œä½†ç»“æœä¸ºç©º |
| `"error"` | æ‰§è¡Œå¤±è´¥       | ä¸­æ–­å½“å‰åœºæ™¯æ‰§è¡Œ      |

---

## ğŸ§± å…­ã€æ ‡å‡†å­—æ®µå‘½å

| å­—æ®µå            | ç±»å‹    | å«ä¹‰       | ç¤ºä¾‹                                 |
| -------------- | ----- | -------- | ---------------------------------- |
| `file`         | str   | é€šç”¨è¾“å‡ºæ–‡ä»¶è·¯å¾„ | `output/scene_1/canvas/canvas.png` |
| `image_out`    | str   | å›¾åƒç»“æœæ–‡ä»¶   | `diagram.png`                      |
| `audio_out`    | str   | éŸ³é¢‘è¾“å‡ºæ–‡ä»¶   | `tts.wav`                          |
| `video_out`    | str   | è§†é¢‘è¾“å‡ºæ–‡ä»¶   | `final.mp4`                        |
| `subtitle_out` | str   | å­—å¹•æ–‡ä»¶è·¯å¾„   | `subtitle.srt`                     |
| `duration`     | float | åª’ä½“é•¿åº¦ï¼ˆç§’ï¼‰  | `4.62`                             |
| `meta`         | dict  | é™„åŠ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ | `{"voice": "XiaoxiaoNeural"}`      |

---

## ğŸª„ ä¸ƒã€æ’ä»¶å‘½åä¸èŒè´£è¾¹ç•Œ

æ¯ä¸ªæ’ä»¶**åªå¤„ç†å•ä¸€åŠŸèƒ½é¢†åŸŸ**ï¼ŒèŒè´£å¿…é¡»æ¸…æ™°ï¼š

| æ’ä»¶å       | èŒè´£      | å…¸å‹è¾“å…¥          | å…¸å‹è¾“å‡º                      |
| --------- | ------- | ------------- | ------------------------- |
| `canvas`  | åˆ›å»ºåœºæ™¯åº•å›¾  | æ—              | `canvas.png`              |
| `d2`      | ç»˜åˆ¶ç»“æ„å›¾   | D2 æ–‡æœ¬         | `diagram.png`             |
| `tts`     | è¯­éŸ³ä¸å­—å¹•åˆæˆ | narration æ–‡æœ¬  | `tts.wav`, `subtitle.srt` |
| `mix`     | æ··éŸ³å¤„ç†    | tts.wav + bgm | `mixed_audio.wav`         |
| `compose` | è§†é¢‘åˆæˆ    | ç”»é¢ + éŸ³é¢‘ + å­—å¹•  | `final.mp4`               |

---

## ğŸ§© å…«ã€æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

1. **æ³¨å†ŒåŠ è½½é˜¶æ®µ**

   * æ‰€æœ‰æ’ä»¶åœ¨å¯åŠ¨æ—¶ç”± `PluginLoader` è‡ªåŠ¨å‘ç°ï¼›
   * åªéœ€åœ¨ `plugins/<name>/plugin.py` å®šä¹‰ `run(ctx)`ã€‚

2. **æ‰§è¡Œé˜¶æ®µ**

   * æ¯ä¸ªåœºæ™¯æŒ‰ `scene.pipeline` é¡ºåºä¾æ¬¡æ‰§è¡Œæ’ä»¶ï¼›
   * æ¯ä¸ªæ’ä»¶çš„è¿”å›ç»“æœä¼šè¢«è‡ªåŠ¨åˆå¹¶åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚

3. **ç»“æœä¼ é€’é˜¶æ®µ**

   * ä¾‹å¦‚ï¼š`tts` â†’ `mix` â†’ `compose`
   * ä¸‹æ¸¸æ’ä»¶é€šè¿‡ `ctx["tts"]["audio_out"]` è·å–ä¸Šæ¸¸ç»“æœã€‚

---

## ğŸ” ä¹ã€è°ƒè¯•ä¸æ—¥å¿—è§„èŒƒ

* æ‰€æœ‰æ—¥å¿—è¾“å‡ºç»Ÿä¸€ä½¿ç”¨ `core.logger.log()`ï¼›
* æ—¥å¿—æ ¼å¼å»ºè®®éµå¾ªï¼š

  ```
  [plugin_name] <action description> ...
  ```
* ç¤ºä¾‹ï¼š

  ```python
  log("[tts] generating speech...")
  log(f"[mix] detected duration = {duration:.2f}s")
  log(f"[compose] output â†’ {output_video}")
  ```

---

## ğŸ§  åã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### âœ… å»ºè®®åšæ³•

* æ‰€æœ‰è·¯å¾„å¿…é¡»é€šè¿‡ `IOManager.get_plugin_dir(scene_dir, plugin)` åˆ›å»ºï¼›
* æ‰€æœ‰å¼‚å¸¸å¿…é¡»æ•è·å¹¶è¿”å› `"status": "error"`ï¼›
* æ‰€æœ‰æ–‡ä»¶å‘½ååº”ç®€çŸ­ä¸”æ— ç©ºæ ¼ï¼›
* ä¿æŒå‡½æ•°å•ä¸€èŒè´£ï¼›
* æ’ä»¶è¾“å‡ºå†…å®¹å¿…é¡»å¯è¿½è¸ªï¼ˆæ—¥å¿—ä¸­æ‰“å°æœ€ç»ˆè·¯å¾„ï¼‰ã€‚

### âŒ ç¦æ­¢åšæ³•

* ä¸å¾—åœ¨æ’ä»¶ä¸­ä¿®æ”¹å…¨å±€é…ç½®ï¼›
* ä¸å¾—ä¾èµ–æ’ä»¶æ‰§è¡Œé¡ºåºä»¥å¤–çš„å…¨å±€çŠ¶æ€ï¼›
* ä¸å¾—æ”¹å˜ä¸Šä¸‹æ–‡ç»“æ„ï¼›
* ä¸å¾—ç›´æ¥è®¿é—®å…¶ä»–æ’ä»¶ç›®å½•ï¼ˆå¿…é¡»é€šè¿‡ ctx è·å–ï¼‰ã€‚

---

## ğŸ§© åä¸€ã€æœ€å°å·¥ä½œæ’ä»¶æ¨¡æ¿

```python
# plugins/example/plugin.py
from core.logger import log
from core.io import IOManager
import os

def run(ctx):
    plugin = "example"
    scene_dir = ctx["scene_dir"]
    out_dir = IOManager.get_plugin_dir(scene_dir, plugin)
    os.makedirs(out_dir, exist_ok=True)

    log(f"[{plugin}] demo plugin running...")
    result_file = os.path.join(out_dir, "result.txt")
    with open(result_file, "w") as f:
        f.write("Hello from example plugin!")

    return {
        plugin: {
            "status": "ok",
            "file": result_file,
            "meta": {"note": "demo completed"}
        }
    }
```

---

## ğŸš€ åäºŒã€æ’ä»¶æµ‹è¯•æ–¹æ³•

å‘½ä»¤è¡Œè¿è¡Œå•ä¸ªæ’ä»¶ï¼š

```bash
python3 neuroforge.py configs/demo.yaml
```

æˆ–å•ç‹¬æµ‹è¯•æ’ä»¶ï¼ˆä¼ªé€ ä¸Šä¸‹æ–‡ï¼‰ï¼š

```python
from plugins.example import plugin
ctx = {
    "meta": {"project": "Demo"},
    "scene": {"title": "Test Scene"},
    "scene_id": 1,
    "scene_dir": "output/scene_1"
}
print(plugin.run(ctx))
```

---

## ğŸ“˜ åä¸‰ã€æ‰©å±•ä¸ç”Ÿæ€

* æ‰€æœ‰æ’ä»¶éµå¾ª **ç»Ÿä¸€è¾“å…¥è¾“å‡ºåè®®**ï¼›
* æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆç›´æ¥æ”¾å…¥ `plugins/<name>`ï¼‰ï¼›
* è°ƒåº¦ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å¹¶è¿è¡Œï¼›
* æœªæ¥ç‰ˆæœ¬ï¼ˆv1.4+ï¼‰å°†å¢åŠ ï¼š

  * æ’ä»¶å£°æ˜æ–‡ä»¶ï¼ˆ`plugin.yaml`ï¼‰
  * æ’ä»¶å…ƒæ•°æ®æ³¨å†Œï¼ˆä½œè€…ã€ç‰ˆæœ¬ã€ä¾èµ–ï¼‰
  * å¯è§†åŒ–èŠ‚ç‚¹åŒ–ç¼–æ’ï¼ˆTimeline Graphï¼‰

---

âœ… **æœ€ç»ˆç»“è®º**

> **NeuroForge v1.3 æ’ä»¶ç³»ç»Ÿæ˜¯ AI è§†é¢‘ç¼–æ’å¼•æ“çš„å¯æ‰©å±•éª¨æ¶ã€‚**
> åªè¦æ’ä»¶éµå¾ªæ­¤æ–‡æ¡£æ ‡å‡†ï¼Œå³å¯è¢«è‡ªåŠ¨å‘ç°ã€æ‰§è¡Œã€ä¸²è”ä¸æ—¶é—´çº¿åˆæˆã€‚
> å®ƒæ—¢æ˜¯æœ€å°æ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯æœªæ¥ AI è§†é¢‘ç”Ÿæˆç”Ÿæ€çš„åŸºç¡€æ¨¡å—ã€‚