# ğŸ§© NeuroForge v1.3 æ’ä»¶æ¨¡æ¿ç”Ÿæˆå™¨

> **æ–‡ä»¶åï¼š** `tools/plugin_generator.py`
> **åŠŸèƒ½ï¼š** ä¸€é”®ç”Ÿæˆæ ‡å‡†åŒ–æ’ä»¶ç›®å½•ä¸æ¨¡æ¿ä»£ç 
> **ç›®æ ‡ï¼š** ä¿è¯æ‰€æœ‰æ’ä»¶éµå¾ª v1.3 æ ‡å‡†ç»“æ„ä¸å‘½åè§„èŒƒ

---

## ğŸ§± ä¸€ã€å·¥å…·åŠŸèƒ½æ¦‚è¿°

| åŠŸèƒ½         | è¯´æ˜                                                              |
| ---------- | --------------------------------------------------------------- |
| ğŸ—ï¸ è‡ªåŠ¨åˆ›å»ºç›®å½• | è‡ªåŠ¨ç”Ÿæˆ `plugins/<name>/plugin.py`                                 |
| ğŸ§¾ è‡ªåŠ¨æ’å…¥æ¨¡æ¿  | æ’å…¥å®Œæ•´ v1.3 æ ‡å‡†æ’ä»¶ç»“æ„ï¼ˆå«æ³¨é‡Šä¸æ—¥å¿—ï¼‰                                        |
| ğŸ§° å¯é€‰è¯´æ˜    | æ”¯æŒå‘½ä»¤è¡Œå¿«é€Ÿç”Ÿæˆï¼Œå¦‚ `python3 tools/plugin_generator.py canvas "ç”Ÿæˆåœºæ™¯åº•å›¾"` |
| ğŸ”„ å¯å¤ç”¨     | å¤šæ¬¡ç”Ÿæˆæ—¶è‡ªåŠ¨é˜²æ­¢è¦†ç›–å·²æœ‰æ–‡ä»¶                                                 |

---

## ğŸ“„ äºŒã€ä»£ç å®ç°

```python
# ===========================================================
# tools/plugin_generator.py
# -----------------------------------------------------------
# NeuroForge v1.3 Plugin Scaffolding Tool
# åŠŸèƒ½ï¼šå¿«é€Ÿç”Ÿæˆç¬¦åˆ v1.3 æ ‡å‡†çš„æ’ä»¶ç›®å½•ä¸æ¨¡æ¿æ–‡ä»¶
# ===========================================================

import os
import sys
from datetime import datetime

TEMPLATE = """# ===========================================================
# NeuroForge v1.3 Plugin: {plugin_name}
# -----------------------------------------------------------
# åŠŸèƒ½ï¼š
#   {description}
# è¾“å…¥ï¼š
#   ctx : dict ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆç”± SceneRunner æ³¨å…¥ï¼‰
# è¾“å‡ºï¼š
#   {{
#     "{plugin_name}": {{
#         "status": "ok" / "error" / "skip",
#         "file" / "audio_out" / "video_out" ç­‰æ ‡å‡†å­—æ®µ,
#         "meta": {{...}} å¯é€‰æ‰©å±•å…ƒæ•°æ®
#     }}
#   }}
# ===========================================================

import os
from core.logger import log
from core.io import IOManager


def run(ctx):
    plugin = "{plugin_name}"
    scene_dir = ctx["scene_dir"]
    out_dir = IOManager.get_plugin_dir(scene_dir, plugin)
    os.makedirs(out_dir, exist_ok=True)

    log(f"[{{plugin}}] started...")

    # =============== æ ¸å¿ƒé€»è¾‘åŒºåŸŸ ===============
    # ç¤ºä¾‹é€»è¾‘ï¼šå†™å…¥ä¸€ä¸ªç®€å•æ–‡ä»¶
    result_file = os.path.join(out_dir, "{plugin_name}_result.txt")
    with open(result_file, "w", encoding="utf-8") as f:
        f.write("Generated by NeuroForge v1.3 plugin: {plugin_name}\\n")

    # =============== è¿”å›ç»Ÿä¸€ç»“æœç»“æ„ ===============
    return {{
        plugin: {{
            "status": "ok",
            "file": result_file,
            "meta": {{
                "created_at": "{timestamp}"
            }}
        }}
    }}
"""

def create_plugin(plugin_name, description="æš‚æ— è¯´æ˜"):
    base_dir = os.path.join("plugins", plugin_name)
    file_path = os.path.join(base_dir, "plugin.py")

    if os.path.exists(file_path):
        print(f"âš ï¸ æ’ä»¶ {plugin_name} å·²å­˜åœ¨ï¼š{file_path}")
        return

    os.makedirs(base_dir, exist_ok=True)
    content = TEMPLATE.format(
        plugin_name=plugin_name,
        description=description,
        timestamp=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    )

    with open(file_path, "w", encoding="utf-8") as f:
        f.write(content)

    print(f"âœ… å·²ç”Ÿæˆæ’ä»¶æ¨¡æ¿ï¼š{file_path}")


if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("ç”¨æ³•ï¼špython3 tools/plugin_generator.py <plugin_name> [description]")
        sys.exit(1)

    name = sys.argv[1]
    desc = sys.argv[2] if len(sys.argv) > 2 else "æš‚æ— è¯´æ˜"
    create_plugin(name, desc)
```

---

## âš™ï¸ ä¸‰ã€ä½¿ç”¨æ–¹æ³•

### ğŸ“˜ ç¤ºä¾‹å‘½ä»¤

```bash
python3 tools/plugin_generator.py caption "ç”Ÿæˆå­—å¹•ä¸å…³é”®å¸§æ ‡æ³¨å±‚"
```

ç”Ÿæˆç»“æœï¼š

```
plugins/
 â””â”€â”€ caption/
     â””â”€â”€ plugin.py
```

æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š

```python
# ===========================================================
# NeuroForge v1.3 Plugin: caption
# -----------------------------------------------------------
# åŠŸèƒ½ï¼š
#   ç”Ÿæˆå­—å¹•ä¸å…³é”®å¸§æ ‡æ³¨å±‚
# è¾“å…¥ï¼š
#   ctx : dict ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆç”± SceneRunner æ³¨å…¥ï¼‰
# è¾“å‡ºï¼š
#   {
#     "caption": {
#         "status": "ok" / "error" / "skip",
#         "file" / "audio_out" / "video_out" ç­‰æ ‡å‡†å­—æ®µ,
#         "meta": {...} å¯é€‰æ‰©å±•å…ƒæ•°æ®
#     }
#   }
# ===========================================================

import os
from core.logger import log
from core.io import IOManager

def run(ctx):
    plugin = "caption"
    scene_dir = ctx["scene_dir"]
    out_dir = IOManager.get_plugin_dir(scene_dir, plugin)
    os.makedirs(out_dir, exist_ok=True)

    log(f"[{plugin}] started...")

    result_file = os.path.join(out_dir, "caption_result.txt")
    with open(result_file, "w", encoding="utf-8") as f:
        f.write("Generated by NeuroForge v1.3 plugin: caption\n")

    return {
        plugin: {
            "status": "ok",
            "file": result_file,
            "meta": {"created_at": "2025-11-19 01:45:00"}
        }
    }
```

---

## ğŸ§© å››ã€å‘½åè§„èŒƒè‡ªåŠ¨æç¤º

* æ’ä»¶åå¿…é¡»ä¸ºè‹±æ–‡å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆï¼›
* å»ºè®®è¯­ä¹‰æ¸…æ™°ã€å•ä¸€èŒè´£ï¼›
* å¸¸è§ç±»åˆ«ç¤ºä¾‹ï¼š

| ç±»åˆ«   | å»ºè®®å‘½å                            | åŠŸèƒ½        |
| ---- | ------------------------------- | --------- |
| å›¾åƒç”Ÿæˆ | `canvas`, `d2`, `visual`        | åˆ›å»ºç”»é¢å†…å®¹    |
| è¯­éŸ³   | `tts`, `voice`, `speech`        | æ–‡æœ¬è½¬è¯­éŸ³     |
| éŸ³é¢‘   | `mix`, `bgm`, `fx`              | æ··éŸ³å¤„ç†      |
| è§†é¢‘   | `compose`, `clip`, `transition` | åˆæˆè¾“å‡º      |
| è¾…åŠ©   | `caption`, `subtitle`, `meta`   | æ–‡æœ¬æ ‡æ³¨æˆ–åæœŸä¿¡æ¯ |

---

## ğŸ§  äº”ã€æœ€ä½³å®è·µï¼ˆv1.3 æ¨èï¼‰

1. **åœ¨æ’ä»¶å†…å§‹ç»ˆä½¿ç”¨ `IOManager.get_plugin_dir()` æ¥æ„å»ºè¾“å‡ºè·¯å¾„**
   â†’ é¿å…ç¡¬ç¼–ç è·¯å¾„é—®é¢˜ã€‚

2. **æ‰€æœ‰æ’ä»¶å¿…é¡»è¿”å›é¡¶å±‚é”® `{plugin_name}`**
   â†’ ä¾‹å¦‚ `{"tts": {...}}`ï¼Œå¦åˆ™ä¸Šä¸‹æ–‡æ— æ³•è¯†åˆ«ã€‚

3. **åŠ¡å¿…æ·»åŠ  `status` å­—æ®µ**
   â†’ `"ok"`, `"error"`, `"skip"` ä¸‰æ€æ ‡å‡†ã€‚

4. **è¾“å‡ºè·¯å¾„éœ€ä¸ºå¯å¤ç°ç»“æ„**

   ```
   output/scene_<id>/<plugin_name>/<output_file>
   ```

5. **å¯åœ¨ `meta` ä¸­è¿”å›æ—¶é•¿ã€å¸§ç‡ã€æ¯”ä¾‹ç­‰æ‰©å±•ä¿¡æ¯**
   ä¾‹å¦‚ï¼š

   ```python
   "meta": {"duration": 4.63, "fps": 30}
   ```

---

## ğŸ§­ å…­ã€å¿«é€Ÿæµ‹è¯•

ç”Ÿæˆæ’ä»¶åï¼Œå¯ç«‹å³æµ‹è¯•è¿è¡Œï¼š

```bash
python3 -m plugins.<plugin_name>.plugin
```

æˆ–é›†æˆåˆ°é…ç½®æ–‡ä»¶ï¼š

```yaml
scenes:
  - id: 1
    title: "Demo Scene"
    narration: "Hello NeuroForge"
    pipeline: [tts, mix, compose, caption]
```

è¿è¡Œï¼š

```bash
python3 neuroforge.py configs/demo.yaml
```

---

## ğŸ§© ä¸ƒã€æœªæ¥æ‰©å±•ï¼ˆv1.4+ é¢„ç•™ï¼‰

æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œ`plugin.yaml` å°†å®šä¹‰ï¼š

```yaml
name: tts
version: 1.3
author: wh
description: æ–‡æœ¬è½¬è¯­éŸ³æ’ä»¶
inputs: [narration]
outputs: [audio_out, subtitle_out]
dependencies: [edge-tts, pydub]
```

ç³»ç»Ÿå°†è‡ªåŠ¨æ£€æµ‹ä¾èµ–ã€ç”Ÿæˆæ–‡æ¡£ä¸å¯è§†åŒ–èŠ‚ç‚¹å›¾ã€‚

---

## âœ… å…«ã€ç»“è¯­

> NeuroForge v1.3 æ’ä»¶æ¨¡æ¿ç”Ÿæˆå™¨æ˜¯æ’ä»¶ç”Ÿæ€çš„å…¥å£ã€‚
> å®ƒä¸ä»…ä¿è¯ç»Ÿä¸€ç»“æ„ã€å‡å°‘å‡ºé”™ï¼Œä¹Ÿè®©æ¯ä¸ªæ’ä»¶æˆä¸º **å¯è§†åŒ–æ—¶é—´çº¿ä¸­çš„ç‹¬ç«‹èŠ‚ç‚¹**ã€‚
>
> **ä¸€å¥è¯å“²å­¦ï¼š**
> â€œè®©æ¯ä¸ªæ’ä»¶åƒä¸€å—ä¹é«˜ç§¯æœ¨ï¼Œç²¾å‡†å’¬åˆï¼Œè‡ªåŠ¨ç¼–æ’ã€‚â€